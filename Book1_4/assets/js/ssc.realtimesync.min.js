/* Licensed under the SpreadsheetConverter 2016-05-13*//*!
 * RealtimeSync - v2.1
 */
"use strict";function autoconnectWebSocket(){check_connectivity.is_internet_connected().done(function(){if(void 0===ssc.realtimesync.connection&&ssc.realtimesync.secretKey&&ssc.realtimesync.IsCloseByError&&ssc.realtimesync.wsUrl&&ssc.realtimesync.callback){try{ssc.realtimesync.openWebSocket(ssc.realtimesync.wsUrl,ssc.realtimesync.callback)}catch(a){}ssc.realtimesync.IsCloseByError=!1,ssc.realtimesync.IsErrorMsgDialogShown=!1,ssc.realtimesync.callback("auto_connect")}WebSocketConnectionPool.start()}).fail(function(){ssc.realtimesync.connection&&1==ssc.realtimesync.connection.readyState&&(ssc.realtimesync.IsCloseByError=!0,ssc.realtimesync.disconnect(),ssc.realtimesync.callback("auto_fail"),ssc.realtimesync.callback("ws_close",{msg:"Connection failure. Error : No Internet connection."})),WebSocketConnectionPool.start()})}function onopen_callback(){void 0!==ssc.realtimesync.connection&&this.callback("ws_open",{msg:"connected successfully"}),this.nodejs||void 0!==this.connection&&this.connection.send("client-connected"),WebSocketConnectionPool.clearAutoConnect(),autoconnectWebSocket()}function onclose_callback(a){if(this.usersCount=0,a.reason&&a.reason.length>1)this.callback("ws_close",{msg:"You have been disconnected. Error : "+a.reason});else if(void 0!==this.connection)this.IsCloseByError=!0,this.callback("ws_close",{msg:"Could not connect to Real-time Sync server, ensure your network connection and try again. If problem persists, please contact SpreadsheetConverter support."});else{var b=this.itigger;this.itigger=!1,this.callback("ws_close",{msg:"You are now disconnected.",callback:b})}1e3!==a.code&&(this.IsCloseByError=!0),this.connection=void 0}function onerror_callback(a){this.debug&&$(this.debugWindowId).html($("<p>",{text:"Sorry, but there's some problem with your connection or the server is down."})),this.IsCloseByError=!0,this.callback("ws_error","Sorry, but there's some problem with your internet-connection or the server is down.")}function onmessage_callback(a){try{var b=JSON.parse(a.data)}catch(c){return}if("me"===b.type)this.myColor=b.data.color,this.myId=b.data.id;else if("count"===b.type)this.usersCount=b.users.length,this.liveUsers=b.users,this.callback("msg_user_change",{users:b.users});else if("history"===b.type){var d=JSON.parse(b.data.text);for(var e in d)document.getElementById(e).value=d[e];recalc_onclick("no-resent")}else"message"===b.type?processMessageData(b.data,this.callback):b.hasOwnProperty("error");this.debug&&this.logRawDataInDebugWindow(a.data)}function arrayObjectIterator(a,b){if(a instanceof Array){for(var c in a)if(a.hasOwnProperty(c))for(var d in a[c])a[c].hasOwnProperty(d)&&b(d,a[c][d])}else for(var c in a)b(c,a[c])}function getUrlVars(){for(var a,b=[],c=window.location.href.slice(window.location.href.indexOf("?")+1).split(/[# &]+/),d=0;d<c.length;d++)a=c[d].split("="),b.push(a[0]),b[a[0]]=a[1];return b}function getHref(){var a=window.location.href.split("#")[0];return a.indexOf("?")>-1&&(a=a.substr(0,a.indexOf("?"))),a}function isBrowserSupportsWS(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],"IE "+(a[1]||"")):"Chrome"===c[1]&&(a=b.match(/\bOPR\/(\d+)/),null!=a)?"Opera "+a[1]:(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),"Chrome"==c[0]&&c[1]>=16||"MSIE"==c[0]&&c[1]>=10||"Firefox"==c[0]&&c[1]>=11||"Safari"==c[0]&&c[1]>=6||"Opera"==c[0]&&c[1]>=12?!0:!1)}window.WebSocket=window.WebSocket||window.MozWebSocket;var ssc=ssc||{};ssc.realtimesync={debugWindowId:"#debugWindow",formUrl:"",secretKey:"",myName:"",myColor:"",myId:-1,usersCount:0,connection:void 0,liveUsers:[],debug:!1,nodejs:!1,LOCAL_STORAGE_PREFIX:"invoice_",IsCloseByError:!1,wsUrl:"",timerAutoConnect:void 0,IsErrorMsgDialogShown:!1,openWebSocket:function(a,b){this.wsUrl=a,this.callback=b;var c=ssc.realtimesync.myName.length>0?"&name="+ssc.realtimesync.myName:"";ssc.realtimesync.secretKey.length<7?this.callback("ws_close",{msg:"Connection failure. Error : key too short, require min 7 chars."}):void 0===this.connection&&(this.connection=new WebSocket(a+"?url="+ssc.realtimesync.formUrl+"&key="+ssc.realtimesync.secretKey+c),this.connection.onopen=onopen_callback.bind(this),this.connection.onclose=onclose_callback.bind(this),this.connection.onerror=onerror_callback.bind(this),this.connection.onmessage=onmessage_callback.bind(this))},itigger:!1,disconnect:function(a){ssc.realtimesync.itigger=a||!1,void 0!==ssc.realtimesync.connection&&(ssc.realtimesync.connection.close(),ssc.realtimesync.connection=void 0)},rememberShareDataToken:function(a){if(window.localStorage)try{{var b=APPNAME+"_"||"Token";window.localStorage[b]||0}window.localStorage[b]=a}catch(c){}},hasShareDataToken:function(){if(!window.localStorage)return-1;try{var a=APPNAME+"_"||"Token",b=window.localStorage[a]||-1;return b}catch(c){return-1}}};var check_connectivity={is_internet_connected:function(){return $.ajax({cache:!1,crossDomain:!0,type:"GET",dataType:"text",timeout:8e3,url:"https://share.spreadsheetconverter.com/echo/"})}},WebSocketConnectionPool={pool:0,start:function(){WebSocketConnectionPool.pool++,1==WebSocketConnectionPool.pool&&(ssc.realtimesync.timerAutoConnect=setTimeout(function(){WebSocketConnectionPool.pool=0,autoconnectWebSocket()},2e4))},clearAutoConnect:function(){clearTimeout(ssc.realtimesync.timerAutoConnect),ssc.realtimesync.timerAutoConnect=void 0,WebSocketConnectionPool.pool=0}},processMessageData=function(a,b){if(a.hasOwnProperty("edit")){var c,d={user:"owl",flag:"A2D959"};if(a.edit.hasOwnProperty("el"))c=a.edit.el,d={user:a.edit.author,flag:a.edit.flag};else{c=Object.keys(a.edit)[0];var e=a.edit[c],d=getLiveUserById(e)}b("msg_edit",{elid:c,value:d})}else if(a.hasOwnProperty("unedit")){var f=a.unedit.hasOwnProperty("el")?a.unedit.el:Object.keys(a.unedit)[0];b("msg_unedit",{elid:f})}else if(a.hasOwnProperty("setvalues")){var g=!1,h=!1;if(a.setvalues instanceof Array?a.setvalues.length>0?g=!0:h=!0:"object"!=typeof a.setvalues||isEmptyObject(a.setvalues)||(g=!0),g&&a.setvalues&&arrayObjectIterator(a.setvalues,function(a,c){b("msg_setvalue",{elid:a,value:c})}),h){var i={};i.setvalues=[];var j=$("#formc input:not([readonly='readonly'],[id^='xl_'],[id^='hS']),textarea,select").serializeObject();$.each(j,function(a,b){var c={};c[a]=b,i.setvalues.push(c)});{$("input:checkbox").each(function(){if(0==$(this).prop("checked")){var a={};a[$(this).attr("name")]=$(this).prop("checked"),i.setvalues.push(a)}})}i.setvalues.length>0&&ssc.realtimesync.connection.send(JSON.stringify(i))}}},isEmptyObject=function(a){return 0===Object.keys(a).length},getLiveUserById=function(a){var b=ssc.realtimesync.liveUsers.filter(function(b){return b.id==a});return b[0]};ssc.realtimesync.addInDebugWindow=function(a,b,c,d){var e='<p><span class="qtip-'+c+'">'+a+"</span> @ "+ +(d.getHours()<10?"0"+d.getHours():d.getHours())+":"+(d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes())+": "+b+"</p>";$(ssc.realtimesync.debugWindowId).prepend(e)},ssc.realtimesync.logRawDataInDebugWindow=function(a){$(ssc.realtimesync.debugWindowId).prepend("> "+a+"<br/>")},ssc.realtimesync.coUpdate=function(a,b){if(ssc.realtimesync.connection&&1==ssc.realtimesync.connection.readyState&&""!==b&&"no-resent"!==b){var c=a[b];ssc.realtimesync.messageSend_setvalues(b,c)}},ssc.realtimesync.messageSend_setvalues=function(a,b){if(ssc.realtimesync.connection&&1==ssc.realtimesync.connection.readyState){var c={setvalues:[]},d={},e=$("#"+a);if((e.is('input:not(":button,:checkbox,:radio"), textarea')||e.is("select"))&&a.indexOf("aux")<1&&"readonly"!=e.attr("readonly"))d[a]=e.val().trim();else if(e.is("input:checkbox")){var f=document.getElementById(a).checked;void 0!=f&&(d[a]=f)}else $("input[name="+a+"]").is("input:radio")&&(d[a]=b);isEmptyObject(d)||c.setvalues.push(d),c.setvalues.length>0&&ssc.realtimesync.connection.send(JSON.stringify(c))}},ssc.realtimesync.shareMyEmail=function(a){if(ssc.realtimesync.connection&&1==ssc.realtimesync.connection.readyState){var b={setemail:a};ssc.realtimesync.connection.send(JSON.stringify(b))}};/*!
 * plugin SSC RealtimeSync for html verson : 8
 * ,___,
 * (0,0)
 * /)__)
 * '' ''
 */
var realtimesynctimer=void 0;!function(a,b,c,d){function e(){var c=getUrlVars().k;if(c){var d=a("#ssc-ls").data("plugin_realtimesync");if(null!==d&&(d.autoConnect(c),-1===ssc.realtimesync.hasShareDataToken()))if(a("#banner_realtimesync").length>0)a("#banner_realtimesync").alert("open");else{var e="<div id='banner_realtimesync' class='alert alert-success alert-dismissable errormessage text-center '>            <button id='btnBannerPane' type='button' class='close' onclick='closeBannerPane_callback()'>&times;</button>            <strong>This form is Real-time Sync enabled.</strong> Your changes in the form will be shared in group : <strong>"+c+"</strong> &nbsp;&nbsp;&nbsp; Please fill your name or email in <a href='#txtWsEmail' onclick='javascript:$(\"#txtWsEmail\").focus();'>Settings dialog  </a><span class='glyphicon glyphicon-bookmark'></span> at toolbar below.       <a href='http://www.spreadsheetconverter.com/liveshare-share-webpage/'><span style='float:right' title='learn more in our website.' data-toggle='tooltip' data-placement='left' class='glyphicon glyphicon-question-sign'></span></a>        </div>";a("body").append(e),realtimesynctimer&&(clearTimeout(realtimesynctimer),realtimesynctimer=null),b.setTimeout(function(){closeBannerPane_callback()},popupTimeout)}}}b.popupTimeout=6e3,a(function(){var b="https:"==c.location.protocol?"wss:":"ws:",f=b+"//share.spreadsheetconverter.com/share2_ws.yaws",g=getUrlVars().d,h=getUrlVars().n,i=a('input:not(":button,[readonly=readonly],:disabled"),select,a.ui-slider-handle,textarea,a.ui-state-active',"#formc");1==g&&(ssc.realtimesync.debug=!0,a("body").append('<div id="debugWindow" class="center"></div>')),1==h?(ssc.realtimesync.nodejs=!0,f=b+"//share2.spreadsheetconverter.com:3000/"):2==h&&(ssc.realtimesync.nodejs=!0,f=b+"//127.0.0.1:8080/"),a("section#ssc-ls").realTimeSyncWidget({websocketUrl:f,autoHidePanel:!0}),e(),a(".dropup").on("show.bs.dropdown",function(){a(".popover").hasClass("in")&&(a("#btnLiveShare").popover("hide"),a("#btnLiveShare").popover("destroy"))});var j=function(a){if(ssc.realtimesync.connection!==d&&1==ssc.realtimesync.connection.readyState){var b={};b.edit=a,ssc.realtimesync.connection.send(JSON.stringify(b))}},k=function(a){if(ssc.realtimesync.connection!==d&&1==ssc.realtimesync.connection.readyState){var b={};b.unedit=a,ssc.realtimesync.connection.send(JSON.stringify(b))}};i.focus(function(){j(this.id)}),i.blur(function(){k(this.id)}),a("[data-panel]").hover(function(a){"mouseenter"==a.type?j(this.id):"mouseleave"==a.type&&k(this.id)}),a("div[id^=slider_]").on("slidestop",function(a,b){ssc.realtimesync.messageSend_setvalues(a.target.id.replace("slider_",""),b.value)}),ssc.realtimesync.ShowDisconnectAlert=function(){toastr&&toastr.info(" You are disconnected from Real-time Sync.")}}),b.closeBannerPane_callback=function(){a("#btnBannerPane").alert("close");var b=getUrlVars().k;b&&-1===ssc.realtimesync.hasShareDataToken()&&ssc.realtimesync.rememberShareDataToken(b)};var f=f||{};f.Widget="<div class='realtimesync btn-group dropup'>                <button id='btnLiveShare' type='button' class='btn btn-sm btn-realtimesync' style='height:30px;padding-right:5px;'>                <!--<span class='realtimesync-logo'></span>-->                <svg class='realtimesync-logo' width='26px' height='18px' viewBox='0 0 347 248' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:sketch='http://www.bohemiancoding.com/sketch/ns'>                <g id='Page-1' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' sketch:type='MSPage'>                <g id='RealtimeSync' sketch:type='MSLayerGroup' transform='translate(-154.000000, -773.000000)' fill='#FFFFFF'>                <path d='M287.548259,871.616279 L266.250424,871.616279 L304.980128,826.879279 L343.709832,871.616279 L321.988355,871.616279 L321.988355,959.558857 L287.548259,959.558857 L287.548259,871.616279 Z M234.775357,975.582413 L213.477522,975.582413 L252.207226,1020.31941 L290.936929,975.582413 L269.215452,975.582413 L269.215452,887.639835 L234.775357,887.639835 L234.775357,975.582413 L234.775357,975.582413 Z M217.328779,956.889412 L217.308942,956.889412 C182.293495,956.889412 154.3565,928.953093 154.3565,894.612941 C154.3565,866.650285 172.967657,842.529388 199.029355,834.874233 C206.359018,809.889632 232.648966,795.244488 257.734861,801.93397 C272.753444,784.174361 294.722848,773.852462 318.424386,773.852462 C353.881544,773.852462 384.279382,797.146444 394.419205,829.741365 L394.419205,829.741365 C385.401669,832.168456 376.931496,835.905381 369.231497,840.732212 C362.129362,813.25726 339.96632,800.863626 318.424386,800.863626 C284.451596,800.863626 270.495929,826.578897 267.013428,836.426063 C253.163107,816.449457 215.571406,831.531518 223.36162,858.270537 C200.039598,854.041834 181.367664,871.59953 181.367664,894.612266 C181.367664,914.057414 197.187823,929.876898 217.308267,929.876898 L217.328779,929.876898 L217.328779,956.889412 L217.328779,956.889412 Z M419.342982,1000.75191 C464.097663,1000.75191 500.3785,965.529266 500.3785,922.07993 C500.3785,878.630594 464.097663,843.407948 419.342982,843.407948 C374.588301,843.407948 338.307464,878.630594 338.307464,922.07993 C338.307464,965.529266 374.588301,1000.75191 419.342982,1000.75191 Z M483.852298,968.62415 L450.526333,968.62415 C450.524665,929.446983 432.395227,948.067823 432.395227,913.736578 C432.395227,901.3437 439.906566,894.618132 449.55078,894.618132 C463.800937,894.618132 473.718223,909.31441 460.22391,936.795347 C455.790565,945.823865 464.944502,947.968752 474.778823,950.419408 C484.608559,952.868262 483.852298,958.466673 483.852298,968.62415 Z M429.716209,945.725695 C417.346701,942.642787 405.832261,939.944453 411.408753,928.588668 C428.382954,894.021004 415.907969,875.535261 397.983647,875.535261 C379.705792,875.535261 367.538481,894.730262 384.558958,928.588668 C390.302212,940.013803 378.354193,942.709434 366.250668,945.725695 C353.886163,948.805902 354.837119,955.847597 354.837119,968.6246 L441.129759,968.6246 C441.129759,955.847146 442.081131,948.805902 429.716209,945.725695 Z' id='cloud-3-icon-2' sketch:type='MSShapeGroup'></path>                </g>                </g>                </svg>                <span style='vertical-align: top;'>Real-time Sync</span>                </button>                <button id='btnUserList' type='button' class='btn dropdown-toggle btn-sm btn-realtimesync' data-toggle='dropdown' style='padding-left:5px;padding-right:5px;'>                    <span id='liveuserscount' class='badge pull-left' style='margin-top:0px; margin-right: 5px;'>0</span>                    <span class='caret'></span>                    <span class='sr-only'>Toggle Dropdown</span>                </button>                <ul id='liveuserslist' class='dropdown-menu pull-right' role='menu'>                    <li>&nbsp;&nbsp;No one is connected.</li>                </ul></div>",f.LiveSharePopover="<section class='realtimesync-body'><div class='row'>            <div class='col-md-12 col-sm-12 text-center'>                <span id='pnlWsError' class='ui-state-text'></span>            </div>        </div>        <div class='row'>            <div class='col-md-12'>                <label for='lsSecretKey' data-toggle='tooltip' data-placement='left' title='provide unique name, so you can use it to save/share/collaborate this form.'>Secret key :                    </label>            </div>            <div class=' col-md-12 col-sm-12'>             <div class='input-group'>                 <input id='txtWsSecretkey' type='text' class='form-control input-sm' id='lsSecretKey' placeholder='secret key' title='provide unique name, so you can use it to save/share/collaborate this form.'>                 <span class='input-group-btn'>                    <button id='btnWsConnect' type='button' data-loading-text='Connecting...' class='btn btn-sm btn-primary wsconnect' style='margin-top: 0px' >Connect</button>                 </span>             </div>            </div>        </div>        <!--</div>-->        <div class='row'>            <div class='col-md-12'>                <label for='txtWsEmail' title='provide your name, so it is used during collaboration'>Your name or email :</label> <i>(optional)</i>            </div>        </div>        <div class='row'>            <div class='col-md-12 col-sm-12'>                <div class='input-group'>                    <input id='txtWsEmail' type='email' class='form-control input-sm' placeholder='name or email' data-toggle='tooltip'                           data-placement='left' title='provide your name, so it is used during collaboration'>                    <span class='input-group-btn'>                               <button id='btnWsEmailShare' type='button' class='btn btn-sm btn-default' style='color: #428bca;'>Share</button>                        </span>                </div>                <span>                    <i>                       It will appear in other's screen.                    </i>                </span>            </div>        </div>        <section id='shareUrl'>        <div style='margin-top: 8px;' class='row'>            <div class='col-md-6'>                <button id='btnShareUrl' type='button' class='btn btn-link btn-xs' data-toggle='tooltip' data-placement='left'                        title='collaborate this form with others'><span class='glyphicon glyphicon-share' style='margin-right: 2px'></span>Share The Link</button>            </div>        </div>        </section></section>",f.getShareUrlPopover="<div>             <p style='width: auto'>Hit <strong>Ctrl + C</strong> to copy the link below.  <br/> Send this link to others to collaborate. </p>             <input id='txtDataShareUrl' class='form-control' type='text' style='width: 100%' value=''/>         </div>",f.BrowserNotSupport="<div>Your browser does not support Real-time Sync feature. \nPlease use Google Chrome, Firefox or Internet Explorer 10 or above.</div>";var g=function(b,c){this.element=a(b),this.element.prepend(f.Widget),this.websocketUrl="undefined"!=typeof c&&c.hasOwnProperty("websocketUrl")?c.websocketUrl:"ws://127.0.0.1:3000/",this.autoHidePanel="undefined"!=typeof c&&c.hasOwnProperty("autoHidePanel")?c.autoHidePanel:!0,this.element.on("click","#btnLiveShare",a.proxy(this._showLiveSharePopover,this)),this.element.on("click","#btnWsConnect",a.proxy(this._connectWebSocket,this)),this.element.on("click","#btnWsEmailShare",a.proxy(this._postEmailShare,this)),this.element.on("click","#btnShareUrl",a.proxy(this._showGetShareUrlPopover,this)),this.element.on("keypress","#txtWsSecretkey",this._enterToConnect),this.element.on("keypress","#txtWsEmail",this._enterToShareNameEmail),this.element.on("focusin","#txtWsSecretkey,#txtWsEmail",function(){realtimesynctimer&&(clearTimeout(realtimesynctimer),realtimesynctimer=null)}),this.element.on("focusout","#txtWsSecretkey,#txtWsEmail",function(){realtimesynctimer&&(clearTimeout(realtimesynctimer),realtimesynctimer=null),realtimesynctimer=setTimeout(function(){a("#btnLiveShare").popover("hide"),a("#btnLiveShare").popover("destroy")},popupTimeout)})},h=function(b){"green"===b.color?a("#RealtimeSync").attr("fill","#24F724"):"white"===b.color&&a("#RealtimeSync").attr("fill","#FFFFFF")};g.prototype={constructor:g,_showLiveSharePopover:function(c){if(a(".popover").hasClass("in")?(a("#btnLiveShare").popover("hide"),a("#btnLiveShare").popover("destroy")):a("#btnLiveShare").popover({animation:!1,trigger:"manual",placement:"top",html:!0,content:function(){return b.isBrowserSupportsWS()?f.LiveSharePopover:f.BrowserNotSupport},title:'<span class="text-info"><strong>Settings</strong></span><button type="button" class="close" aria-label="Close" onclick="$(&quot;#btnLiveShare&quot;).popover(&quot;hide&quot;);"><span aria-hidden="true">&times;</span></button><a href="http://www.spreadsheetconverter.com/support/tutorials/liveshare-share-webpage/" class="realtimesync-help-button glyphicon glyphicon-question-sign" target="_blank" title="about Real-time Sync."></a></h3>'}).popover("show"),c.hasOwnProperty("autoconnection")||"undefined"!=typeof co&&!a.isEmptyObject(co)||(a("#pnlWsError").text("Real-time Sync doesnot work without calculation in page. Read more about ").css({color:"#cd0a0a"}).append('<a href="http://www.spreadsheetconverter.com/support/tutorials/liveshare-share-webpage/" target="_blank">limitations</a>'),a(".popover").css("top","-211px"),a("#pnlWsError").attr("data-error",!0)),ssc.realtimesync.secretKey&&a("#txtWsSecretkey").val(ssc.realtimesync.secretKey),ssc.realtimesync.myName&&a("#txtWsEmail").val(ssc.realtimesync.myName),ssc.realtimesync.connection!==d){var e=a("#btnWsConnect");e.text("Disconnect").addClass("btn-success")}a("#txtWsSecretkey").on("input propertychange paste",function(){ssc.realtimesync.connection!==d&&ssc.realtimesync.disconnect(!0)})},_showGetShareUrlPopover:function(b){b.stopPropagation(),b.preventDefault(),a("#btnLiveShare").popover("destroy");var c=getHref();if(ssc.realtimesync.secretKey){var d=c+"?k="+ssc.realtimesync.secretKey;location.href.indexOf("n=1")>-1&&(d+="&n=1"),a("#btnLiveShare").popover({animation:!1,trigger:"manual",placement:"top",html:!0,content:function(){return f.getShareUrlPopover},title:'<span class="text-info"><strong>Share The Link</strong></span><button type="button" id="close" class="close" onclick="$(&quot;#btnLiveShare&quot;).popover(&quot;destroy&quot;);">&times;</button>'}).popover("show"),a("#txtDataShareUrl").val(d),a("#txtDataShareUrl").select()}},_connectWebSocket:function(c){if(c.stopPropagation(),c.preventDefault(),a("#pnlWsError").attr("data-error")===d){var e=this.websocketUrl,f=a("#btnWsConnect");if(ssc.realtimesync.connection===d){f.button("loading"),ssc.realtimesync.formUrl=getHref();var g=a("#txtWsSecretkey").val();ssc.realtimesync.secretKey=g.trim(),a("#txtWsEmail").val().length>1&&(ssc.realtimesync.myName=a("#txtWsEmail").val());var i=this.autoHidePanel;ssc.realtimesync.openWebSocket(e,function(c,e){switch(c){case"error":realtimesynctimer&&(b.clearTimeout(realtimesynctimer),realtimesynctimer=null),a("#pnlWsError").text(err),a("#pnlWsError").css({color:"#cd0a0a"});try{a("div.popover").css({top:-1*parseInt(a(".popover")[0].offsetHeight,10)})}catch(g){}ssc.realtimesync.connection!==d&&1!==ssc.realtimesync.connection.readyState&&(a(liveuserscount).text("0"),a("#liveuserslist").empty(),a("#liveuserslist").html("&nbsp;&nbsp;No one is connected."),f.text("Connect").removeClass("btn-success").addClass("btn-primary"),h({color:"white"}),a(b).unbind("beforeunload"));break;case"msg_edit":a("#"+e.elid).qtip({content:{text:e.value.user},position:{my:"center left",at:"top right",target:a("#"+e.elid),adjust:{x:3,y:13}},style:{bgColor:"#"+e.value.flag,color:"#FFFFFF",borderColor:"#"+e.value.flag},hide:!1}).qtip("show");break;case"msg_unedit":a("#"+e.elid).qtip("destroy");break;case"msg_setvalue":{var j=e.elid,k=e.value,l=!1;a("#"+j.replace("$","\\$"))}ssc.formBinder.isNewValue(j,k)&&(ssc.formBinder.bind(j,k),l=!0),l&&recalc_onclick("no-resent");break;case"ws_open":f.button("reset"),a("#pnlWsError").empty(),a("#pnlWsError").text("You are now connected."),a("#pnlWsError").css({color:"#47a447"});try{a("div.popover").css({top:-1*parseInt(a(".popover")[0].offsetHeight,10)})}catch(g){}f.text("Disconnect").addClass("btn-success"),h({color:"green"}),i?(realtimesynctimer&&(clearTimeout(realtimesynctimer),realtimesynctimer=null),realtimesynctimer=b.setTimeout(function(){a("#btnLiveShare").popover("hide"),a("#btnLiveShare").popover("destroy")},popupTimeout)):this.autoHidePanel=!0,a(b).bind("beforeunload",function(){return"You have been connected to a Real-time Sync session. If you navigate away from this page, your connection will be lost and you need to connect again."});break;case"msg_user_change":a("#liveuserscount").text(e.users.length),a("#liveuserslist").empty();for(var m=0;m<e.users.length;m++){var n=ssc.realtimesync.myId===e.users[m].id?'<span class="glyphicon glyphicon-user"></span>':"";a("#liveuserslist").append('<li><div class="userlist"><div class="flag" style="background-color: #'+e.users[m].flag+'">'+n+'</div><span class="text">'+e.users[m].user+"</span></div></li>")}break;case"ws_close":if(a("#pnlWsError").text(e.msg),a("#pnlWsError").css({color:"#cd0a0a"}),ssc.realtimesync.connection!==d){var o=a("#btnWsConnect");o.text("Connect").removeClass("btn-success").addClass("btn-primary")}try{a("div.popover").css({top:-1*parseInt(a(".popover")[0].offsetHeight,10)})}catch(g){}a(liveuserscount).text("0"),a("#liveuserslist").empty(),a("#liveuserslist").html("&nbsp;&nbsp;No one is connected."),f.text("Connect").removeClass("btn-success").addClass("btn-primary"),h({color:"white"}),e.msg.length>0&&e.msg.indexOf("Error")>-1?realtimesynctimer&&(b.clearTimeout(realtimesynctimer),realtimesynctimer=null):e.callback||(realtimesynctimer&&(clearTimeout(realtimesynctimer),realtimesynctimer=null),realtimesynctimer=b.setTimeout(function(){a("#btnLiveShare").popover("hide"),a("#btnLiveShare").popover("destroy")},popupTimeout)),a(b).unbind("beforeunload");break;case"auto_fail":toastr.warning("No Internet Connection","Realtime-Sync Error.",{timeOut:1e4});break;case"auto_connect":toastr.info("Realtime-Sync Connected.",{timeOut:6e3})}})}else ssc.realtimesync.connection!==d&&(ssc.realtimesync.disconnect(),f.text("Connect").removeClass("btn-success").addClass("btn-primary"),ssc.realtimesync.timerAutoConnect&&clearTimeout(ssc.realtimesync.timerAutoConnect))}},_postEmailShare:function(c){if(c.stopPropagation(),c.preventDefault(),ssc.realtimesync.connection!==d){var e=a("#txtWsEmail").val();e=e.trim(),e.length>0&&(ssc.realtimesync.myName=e,ssc.realtimesync.shareMyEmail(e),a("#pnlWsError").text("Your name or email has been shared."),a("#pnlWsError").css({color:"#47a447"}),a("div.popover").css({top:-1*parseInt(a(".popover")[0].offsetHeight,10)}),realtimesynctimer&&(clearTimeout(realtimesynctimer),realtimesynctimer=null),realtimesynctimer=b.setTimeout(function(){a("#btnLiveShare").popover("hide"),a("#btnLiveShare").popover("destroy")},popupTimeout),a("#btnBannerPane").alert("close"))}},_enterToConnect:function(b){a("#btnWsConnect").removeClass("disabled"),a("#btnWsConnect").prop("disabled",!1);var c=b.keyCode?b.keyCode:b.which;"13"==c&&a("#btnWsConnect").click()},_enterToShareNameEmail:function(b){var c=b.keyCode?b.keyCode:b.which;"13"==c&&a("#btnWsEmailShare").click()},destroy:function(){a.Widget.prototype.destroy.call(this)},autoConnect:function(b){this.autoHidePanel=!0,this._showLiveSharePopover({autoconnection:!0}),a("#txtWsSecretkey").val(b),a("#btnWsConnect").click(),a("#txtWsEmail").focus()}},a.fn.realTimeSyncWidget=function(b){return this.each(function(){a.data(this,"plugin_realtimesync")||a.data(this,"plugin_realtimesync",new g(this,b))}),this}}(jQuery,window,document);